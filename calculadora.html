<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora</title>
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--btn:#1f2937;--accent:#06b6d4;--accent-2:#10b981;--text:#e6eef8}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#071029 0%,#01121a 100%);color:var(--text);padding:24px}
    .calculator{width:360px;max-width:96vw;background:var(--panel);border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,.6)}
    .display{height:72px;background:linear-gradient(180deg,#071829,#02131b);border-radius:8px;padding:12px;display:flex;flex-direction:column;justify-content:center;align-items:flex-end;color:var(--text);font-size:28px;overflow:hidden}
    .display .expr{font-size:14px;color:rgba(230,238,248,.6);word-break:break-all}
    .pad{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:14px}
    button{height:56px;border-radius:8px;border:0;background:var(--btn);color:var(--text);font-size:18px;cursor:pointer;box-shadow:inset 0 -4px 0 rgba(0,0,0,.25)}
    button.operator{background:linear-gradient(180deg,var(--accent),#0891b2);font-weight:600}
    button.equals{grid-column:span 2;background:linear-gradient(180deg,var(--accent-2),#059669);font-weight:700}
    button.wide{grid-column:span 2}
    button:active{transform:translateY(1px)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculadora">
    <div class="display" id="display" aria-live="polite">
      <div class="expr" id="expr" aria-hidden="true">&nbsp;</div>
      <div id="result">0</div>
    </div>

    <div class="pad" role="group" aria-label="Teclado de la calculadora">
      <button type="button" data-action="clear" aria-label="Limpiar">C</button>
      <button type="button" data-action="back" aria-label="Borrar">⌫</button>
      <button type="button" data-action="percent" aria-label="Porcentaje">%</button>
      <button type="button" class="operator" data-value="/" aria-label="Dividir">÷</button>

      <button type="button" data-value="7">7</button>
      <button type="button" data-value="8">8</button>
      <button type="button" data-value="9">9</button>
      <button type="button" class="operator" data-value="*" aria-label="Multiplicar">×</button>

      <button type="button" data-value="4">4</button>
      <button type="button" data-value="5">5</button>
      <button type="button" data-value="6">6</button>
      <button type="button" class="operator" data-value="-" aria-label="Restar">−</button>

      <button type="button" data-value="1">1</button>
      <button type="button" data-value="2">2</button>
      <button type="button" data-value="3">3</button>
      <button type="button" class="operator" data-value="+" aria-label="Sumar">+</button>

      <button type="button" class="wide" data-action="negate" aria-label="Negar">+/-</button>
      <button type="button" data-value="0">0</button>
      <button type="button" data-value="." aria-label="Decimal">.</button>

      <button type="button" class="equals" data-action="equals" aria-label="Igual">=</button>
    </div>

    <p class="sr-only" id="hint">Puedes usar el teclado: números, + - * / ( ) , Enter para igual y Backspace para borrar.</p>
  </main>

  <script>
    (function(){
      const exprEl = document.getElementById('expr');
      const resultEl = document.getElementById('result');
      const pad = document.querySelector('.pad');

      let expr = '';

      function update(){
        exprEl.textContent = expr || '\u00A0';
        resultEl.textContent = (expr && safeEvalPreview(expr)) ?? '0';
      }

      function safeEvalPreview(s){
        try{
          if(!/^[0-9+\-*/().%\s]+$/.test(s)) return '';
          // Replace × ÷ to JS-friendly symbols (if any)
          const clean = s.replace(/÷/g, '/').replace(/×/g, '*').replace(/%/g, '/100');
          const val = Function('return (' + clean + ')')();
          if(typeof val === 'number' && isFinite(val)) return +(+val).toPrecision(12);
        }catch(e){ }
        return '';
      }

      function safeEvalFinal(s){
        if(!/^[0-9+\-*/().%\s]+$/.test(s)) throw new Error('Expresión no válida');
        const clean = s.replace(/÷/g, '/').replace(/×/g, '*').replace(/%/g, '/100');
        const val = Function('return (' + clean + ')')();
        if(typeof val !== 'number' || !isFinite(val)) throw new Error('Resultado no válido');
        return val;
      }

      pad.addEventListener('click', e=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const v = btn.dataset.value;
        const action = btn.dataset.action;
        if(v) insert(v);
        else if(action) handleAction(action);
        update();
      });

      function insert(ch){
        // prevent two decimals in the same number segment
        if(ch === '.'){
          const parts = expr.split(/[^0-9.]/);
          const last = parts[parts.length-1];
          if(last.includes('.')) return;
        }
        expr += ch;
      }

      function handleAction(action){
        if(action === 'clear'){ expr = ''; }
        else if(action === 'back'){ expr = expr.slice(0,-1); }
        else if(action === 'percent'){ expr += '%'; }
        else if(action === 'negate'){
          if(!expr) return;
          // try to negate last number
          const m = /([0-9.]+)\s*$/.exec(expr);
          if(m){
            const num = m[1];
            const start = expr.length - num.length;
            expr = expr.slice(0,start) + '(' + (-Number(num)) + ')';
          }
        }
        else if(action === 'equals'){
          try{
            const val = safeEvalFinal(expr||'0');
            expr = String(+(+val).toPrecision(12));
          }catch(err){
            expr = '';
            resultEl.textContent = 'Error';
          }
        }
      }

      // keyboard support
      window.addEventListener('keydown', e=>{
        if(e.key >= '0' && e.key <= '9'){ insert(e.key); e.preventDefault(); update(); return; }
        if(e.key === '.') { insert('.'); e.preventDefault(); update(); return; }
        if(['+','-','*','/','(',')'].includes(e.key)){ insert(e.key); e.preventDefault(); update(); return; }
        if(e.key === 'Enter'){ handleAction('equals'); e.preventDefault(); update(); return; }
        if(e.key === 'Backspace'){ handleAction('back'); e.preventDefault(); update(); return; }
        if(e.key === 'Escape'){ handleAction('clear'); e.preventDefault(); update(); return; }
        if(e.key === '%'){ insert('%'); e.preventDefault(); update(); return; }
      });

      // initialize
      update();
    })();
  </script>
</body>
</html>
